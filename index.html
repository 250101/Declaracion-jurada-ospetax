<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Declaraci√≥n Jurada de Salud - OSPETAX</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #0056b3;
            --secondary-color: #f8f9fa;
            --accent-color: #28a745;
            --border-color: #dee2e6;
            --text-color: #333;
            --error-color: #dc3545;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body { 
            font-family: 'Roboto', Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            color: var(--text-color);
            background-color: #f5f5f5;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        
        h1 { 
            font-size: 22px; 
            text-align: center; 
            margin: 10px 0;
            color: var(--primary-color);
        }
        
        h2 { 
            font-size: 18px; 
            text-align: center; 
            margin: 15px 0;
            padding-bottom: 5px;
            border-bottom: 2px solid var(--primary-color);
            color: var(--primary-color);
        }
        
        h3 { 
            font-size: 16px; 
            margin: 15px 0 10px;
            color: var(--primary-color);
            border-left: 4px solid var(--primary-color);
            padding-left: 10px;
        }
        
        .card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            border: 1px solid var(--border-color);
        }
        
        .card-header {
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
            margin-bottom: 15px;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        table { 
            border-collapse: collapse; 
            width: 100%; 
            margin: 15px 0;
            border-radius: 5px;
            overflow: hidden;
        }
        
        th, td { 
            border: 1px solid var(--border-color); 
            padding: 10px; 
            font-size: 14px;
        }
        
        th { 
            background-color: var(--primary-color); 
            color: white;
            text-align: left;
            font-weight: 500;
        }
        
        tr:nth-child(even) {
            background-color: var(--secondary-color);
        }
        
        input, textarea, select { 
            width: 100%; 
            padding: 8px 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 14px;
            transition: border-color 0.3s;
            font-family: 'Roboto', Arial, sans-serif;
        }
        
        input:focus, textarea:focus, select:focus { 
            outline: none; 
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(0,86,179,0.2);
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-row {
            display: flex;
            flex-wrap: wrap;
            margin: 0 -10px;
        }
        
        .form-col {
            flex: 1;
            padding: 0 10px;
            min-width: 200px;
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            font-size: 14px;
        }
        
        .required:after {
            content: " *";
            color: var(--error-color);
        }
        
        .header {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .logo {
            width: 100px;
            height: auto;
            margin-right: 30px;
            border: 1px solid var(--border-color);
            padding: 5px;
            background: #fff;
        }
        
        .header-text {
            flex: 1;
        }
        
        .header-text p {
            margin: 3px 0;
            font-size: 14px;
        }
        
        .btn {
            display: inline-block;
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
            text-align: center;
            font-weight: 500;
        }
        
        .btn:hover {
            background-color: #004494;
        }
        
        .btn-secondary {
            background-color: #6c757d;
        }
        
        .btn-secondary:hover {
            background-color: #5a6268;
        }
        
        .btn-success {
            background-color: #28a745;
        }
        
        .btn-success:hover {
            background-color: #218838;
        }
        
        .btn-block {
            display: block;
            width: 100%;
        }
        
        .text-center {
            text-align: center;
        }
        
        .mt-4 {
            margin-top: 20px;
        }
        
        .mb-4 {
            margin-bottom: 20px;
        }
        
        .signature-container {
            border: 1px dashed var(--border-color);
            border-radius: 4px;
            padding: 10px;
            margin-top: 10px;
            background-color: #f8f9fa;
        }
        
        canvas {
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: white;
            margin-top: 10px;
            touch-action: none;
            width: 100%;
            max-width: 400px;
        }
        
        .success-message {
            display: none;
            background-color: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
            text-align: center;
            border: 1px solid #c3e6cb;
        }
        
        .error-message {
            display: none;
            background-color: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
            text-align: center;
            border: 1px solid #f5c6cb;
        }
        
        .small-text {
            font-size: 12px;
            color: #6c757d;
        }
        
        .important-notice {
            background-color: #fff3cd;
            border: 1px solid #ffeeba;
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
        }
        
        .important-notice strong {
            color: #856404;
        }
        
        .file-upload {
            border: 2px dashed var(--border-color);
            padding: 20px;
            text-align: center;
            border-radius: 4px;
            margin-top: 10px;
            background-color: var(--secondary-color);
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .file-upload:hover {
            border-color: var(--primary-color);
        }
        
        .file-upload-input {
            display: none;
        }
        
        .file-list {
            margin-top: 10px;
            padding: 0;
            list-style: none;
        }
        
        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            background-color: #e9ecef;
            border-radius: 4px;
            margin-bottom: 5px;
        }
        
        .file-remove {
            color: var(--error-color);
            cursor: pointer;
            font-weight: bold;
        }
        
        .progress-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background-color: #f3f3f3;
            z-index: 1000;
        }
        
        .progress-bar {
            height: 100%;
            background-color: var(--primary-color);
            width: 0;
            transition: width 0.3s;
        }
        
        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            position: relative;
        }
        
        .step-indicator::before {
            content: '';
            position: absolute;
            top: 15px;
            left: 0;
            right: 0;
            height: 2px;
            background-color: var(--border-color);
            z-index: 1;
        }
        
        .step {
            position: relative;
            z-index: 2;
            text-align: center;
            flex: 1;
        }
        
        .step-number {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: white;
            border: 2px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 5px;
            font-weight: bold;
            color: var(--text-color);
        }
        
        .step.active .step-number {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
        }
        
        .step.completed .step-number {
            background-color: var(--accent-color);
            border-color: var(--accent-color);
            color: white;
        }
        
        .step-title {
            font-size: 12px;
            color: var(--text-color);
        }
        
        .form-section {
            display: none;
        }
        
        .form-section.active {
            display: block;
        }
        
        .form-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        
        .download-button-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }
        
        /* Estilos para las previsualizaciones de im√°genes */
        .image-preview-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        
        .image-preview {
            width: 150px;
            height: 150px;
            object-fit: cover;
            border: 1px solid var(--border-color);
            border-radius: 4px;
        }
        
        /* Estilos para el modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1050;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
        }
        
        .modal-content {
            background-color: #fefefe;
            margin: 10% auto;
            padding: 0;
            border: 1px solid #888;
            width: 80%;
            max-width: 500px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .modal-header {
            padding: 15px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .modal-footer {
            padding: 15px;
            border-top: 1px solid #e9ecef;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .close-modal {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close-modal:hover,
        .close-modal:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
        
        /* Estilos para el indicador de carga */
        #loadingIndicator {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.8);
            z-index: 2000;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        .spinner {
            display: inline-block;
            width: 50px;
            height: 50px;
            border: 5px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Estilos para mensajes de validaci√≥n */
        .validation-error {
            color: var(--error-color);
            font-size: 12px;
            margin-top: 5px;
            display: none;
        }
        
        input.invalid, textarea.invalid, select.invalid {
            border-color: var(--error-color);
        }
        
        /* Estilos para el bot√≥n de Google Drive */
        .google-drive-button {
            background-color: #4285F4;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-top: 15px;
        }
        
        .google-drive-button:hover {
            background-color: #3367D6;
        }
        
        .google-drive-icon {
            width: 20px;
            height: 20px;
        }
        
        .google-drive-status {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            display: none;
        }
        
        .google-drive-status.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }
        
        .google-drive-status.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .header {
                flex-direction: column;
                text-align: center;
            }
            
            .logo {
                margin-right: 0;
                margin-bottom: 15px;
            }
            
            .form-col {
                flex: 0 0 100%;
            }
            
            table {
                display: block;
                overflow-x: auto;
                white-space: nowrap;
            }
            
            .step-title {
                display: none;
            }
            
            .download-button-container {
                bottom: 10px;
                right: 10px;
            }
            
            .image-preview {
                width: 100px;
                height: 100px;
            }
        }
        
        @media print {
            body {
                background-color: white;
                padding: 0;
                margin: 0;
            }
            
            .container {
                box-shadow: none;
                padding: 0;
                max-width: 100%;
            }
            
            .btn, .file-upload, .signature-container button {
                display: none;
            }
            
            .form-navigation, .step-indicator {
                display: none;
            }
            
            .form-section {
                display: block;
            }
            
            .download-button-container {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="progress-container">
        <div class="progress-bar" id="progressBar"></div>
    </div>

    <!-- Bot√≥n flotante para descargar PDF en cualquier momento -->
    <div class="download-button-container">
        <button type="button" class="btn btn-success" onclick="downloadPDF()">
            Descargar PDF
        </button>
    </div>

    <!-- Indicador de carga -->
    <div id="loadingIndicator" style="display: none;">
        <div class="spinner"></div>
        <p style="margin-top: 15px;" id="loadingText">Generando PDF, por favor espere...</p>
    </div>

    <div class="container" id="formContainer">
        <div class="header">
            <img src="https://racais.com.ar/img/obrasSociales/ospetax.jpg" alt="Logo OSPETAX" class="logo" id="logoOspetax" crossorigin="anonymous">
            <div class="header-text">
                <h1>OBRA SOCIAL DE PEONES DE TAXI DE LA CAPITAL FEDERAL</h1>
                <p>RNOS 1-2370-1</p>
                <p>Av. La Plata N¬∞ 1562/64</p>
                <p>Tel√©fonos: 011-4920-7000/7099</p>
                <p>CP: C1250AAS</p>
                <p>Ciudad Aut√≥noma de Buenos Aires</p>
                <p>www.ospetax.org.ar</p>
            </div>
        </div>

        <h2>DECLARACI√ìN JURADA DE SALUD</h2>

        <div class="step-indicator">
            <div class="step active" data-step="1">
                <div class="step-number">1</div>
                <div class="step-title">Datos Personales</div>
            </div>
            <div class="step" data-step="2">
                <div class="step-number">2</div>
                <div class="step-title">Informaci√≥n de Salud</div>
            </div>
            <div class="step" data-step="3">
                <div class="step-number">3</div>
                <div class="step-title">Grupo Familiar</div>
            </div>
            <div class="step" data-step="4">
                <div class="step-number">4</div>
                <div class="step-title">Documentaci√≥n</div>
            </div>
            <div class="step" data-step="5">
                <div class="step-number">5</div>
                <div class="step-title">Confirmaci√≥n</div>
            </div>
        </div>

        <form id="healthForm" onsubmit="submitForm(event)">
            <!-- Secci√≥n 1: Datos Personales -->
            <div class="form-section active" id="section1">
                <div class="card">
                    <div class="card-header">Datos del Titular</div>
                    <div class="form-row">
                        <div class="form-col">
                            <label for="titular_nombre" class="required">Apellido y Nombre del Titular</label>
                            <input type="text" id="titular_nombre" name="titular_nombre" required>
                            <div class="validation-error" id="titular_nombre_error">Este campo es obligatorio</div>
                        </div>
                        <div class="form-col">
                            <label for="titular_cuit" class="required">CUIT</label>
                            <input type="text" id="titular_cuit" name="titular_cuit" placeholder="XX-XXXXXXXX-X" required pattern="\d{2}-\d{8}-\d{1}">
                            <div class="validation-error" id="titular_cuit_error">Ingrese un CUIT v√°lido (XX-XXXXXXXX-X)</div>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-col">
                            <label for="opcion_numero">Opci√≥n N¬∞</label>
                            <input type="number" id="opcion_numero" name="opcion_numero">
                        </div>
                        <div class="form-col">
                            <label for="titular_fecha_nac" class="required">Fecha de Nacimiento</label>
                            <input type="date" id="titular_fecha_nac" name="titular_fecha_nac" required>
                            <div class="validation-error" id="titular_fecha_nac_error">Este campo es obligatorio</div>
                        </div>
                        <div class="form-col">
                            <label for="titular_edad" class="required">Edad</label>
                            <input type="number" id="titular_edad" name="titular_edad" required readonly>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-col">
                            <label for="titular_email" class="required">Email</label>
                            <input type="email" id="titular_email" name="titular_email" required>
                            <div class="validation-error" id="titular_email_error">Ingrese un email v√°lido</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">Domicilio</div>
                    <div class="form-row">
                        <div class="form-col">
                            <label for="domicilio" class="required">Domicilio Real</label>
                            <input type="text" id="domicilio" name="domicilio" required>
                            <div class="validation-error" id="domicilio_error">Este campo es obligatorio</div>
                        </div>
                        <div class="form-col">
                            <label for="domicilio_numero" class="required">N¬∞</label>
                            <input type="number" id="domicilio_numero" name="domicilio_numero" required>
                            <div class="validation-error" id="domicilio_numero_error">Este campo es obligatorio</div>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-col">
                            <label for="piso">Piso</label>
                            <input type="text" id="piso" name="piso">
                        </div>
                        <div class="form-col">
                            <label for="dto">Dto</label>
                            <input type="text" id="dto" name="dto">
                        </div>
                        <div class="form-col">
                            <label for="barrio">Barrio</label>
                            <input type="text" id="barrio" name="barrio">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-col">
                            <label for="partido">Partido</label>
                            <input type="text" id="partido" name="partido">
                        </div>
                        <div class="form-col">
                            <label for="cod_postal" class="required">C√≥digo Postal</label>
                            <input type="text" id="cod_postal" name="cod_postal" required>
                            <div class="validation-error" id="cod_postal_error">Este campo es obligatorio</div>
                        </div>
                        <div class="form-col">
                            <label for="provincia" class="required">Provincia</label>
                            <input type="text" id="provincia" name="provincia" required>
                            <div class="validation-error" id="provincia_error">Este campo es obligatorio</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">Informaci√≥n de Contacto</div>
                    <div class="form-row">
                        <div class="form-col">
                            <label for="telefono">Tel√©fono</label>
                            <input type="tel" id="telefono" name="telefono">
                        </div>
                        <div class="form-col">
                            <label for="celular" class="required">Celular</label>
                            <input type="tel" id="celular" name="celular" required>
                            <div class="validation-error" id="celular_error">Este campo es obligatorio</div>
                        </div>
                        <div class="form-col">
                            <label for="email_contacto">E-mail</label>
                            <input type="email" id="email_contacto" name="email_contacto">
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">Contacto de Emergencia</div>
                    <div class="form-row">
                        <div class="form-col">
                            <label for="contacto_nombre" class="required">Apellido y Nombres</label>
                            <input type="text" id="contacto_nombre" name="contacto_nombre" required>
                            <div class="validation-error" id="contacto_nombre_error">Este campo es obligatorio</div>
                        </div>
                        <div class="form-col">
                            <label for="contacto_relacion" class="required">Relaci√≥n</label>
                            <input type="text" id="contacto_relacion" name="contacto_relacion" required>
                            <div class="validation-error" id="contacto_relacion_error">Este campo es obligatorio</div>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-col">
                            <label for="contacto_celular" class="required">Celular</label>
                            <input type="tel" id="contacto_celular" name="contacto_celular" required>
                            <div class="validation-error" id="contacto_celular_error">Este campo es obligatorio</div>
                        </div>
                        <div class="form-col">
                            <label for="contacto_domicilio">Domicilio</label>
                            <input type="text" id="contacto_domicilio" name="contacto_domicilio">
                        </div>
                        <div class="form-col">
                            <label for="contacto_numero">N¬∞</label>
                            <input type="number" id="contacto_numero" name="contacto_numero">
                        </div>
                        <div class="form-col">
                            <label for="contacto_barrio">Barrio</label>
                            <input type="text" id="contacto_barrio" name="contacto_barrio">
                        </div>
                    </div>
                </div>

                <div class="form-navigation">
                    <div></div>
                    <button type="button" class="btn" onclick="validateAndNext(1)">Siguiente</button>
                </div>
            </div>

            <!-- Secci√≥n 2: Informaci√≥n de Salud -->
            <div class="form-section" id="section2">
                <div class="card">
                    <div class="card-header">Informaci√≥n de Salud del Grupo Familiar</div>
                    <p class="mb-4">Complete todos los datos del grupo familiar que van a ingresar a la cobertura del titular</p>
                    
                    <div class="table-responsive">
                        <table>
                            <thead>
                                <tr>
                                    <th>Detalle</th>
                                    <th>Titular</th>
                                    <th>Esposa/o</th>
                                    <th>Hijo</th>
                                    <th>Hijo</th>
                                    <th>Hijo</th>
                                    <th>Hijo</th>
                                    <th>Hijo</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Edad</td>
                                    <td><input type="number" name="edad_titular"></td>
                                    <td><input type="number" name="edad_esposa"></td>
                                    <td><input type="number" name="edad_hijo1"></td>
                                    <td><input type="number" name="edad_hijo2"></td>
                                    <td><input type="number" name="edad_hijo3"></td>
                                    <td><input type="number" name="edad_hijo4"></td>
                                    <td><input type="number" name="edad_hijo5"></td>
                                </tr>
                                <tr>
                                    <td>Peso</td>
                                    <td><input type="number" name="peso_titular"></td>
                                    <td><input type="number" name="peso_esposa"></td>
                                    <td><input type="number" name="peso_hijo1"></td>
                                    <td><input type="number" name="peso_hijo2"></td>
                                    <td><input type="number" name="peso_hijo3"></td>
                                    <td><input type="number" name="peso_hijo4"></td>
                                    <td><input type="number" name="peso_hijo5"></td>
                                </tr>
                                <tr>
                                    <td>Altura</td>
                                    <td><input type="number" name="altura_titular"></td>
                                    <td><input type="number" name="altura_esposa"></td>
                                    <td><input type="number" name="altura_hijo1"></td>
                                    <td><input type="number" name="altura_hijo2"></td>
                                    <td><input type="number" name="altura_hijo3"></td>
                                    <td><input type="number" name="altura_hijo4"></td>
                                    <td><input type="number" name="altura_hijo5"></td>
                                </tr>
                                <tr>
                                    <td>Fuma / Ctos</td>
                                    <td><input type="text" name="fuma_titular"></td>
                                    <td><input type="text" name="fuma_esposa"></td>
                                    <td><input type="text" name="fuma_hijo1"></td>
                                    <td><input type="text" name="fuma_hijo2"></td>
                                    <td><input type="text" name="fuma_hijo3"></td>
                                    <td><input type="text" name="fuma_hijo4"></td>
                                    <td><input type="text" name="fuma_hijo5"></td>
                                </tr>
                                <tr>
                                    <td>Cirug√≠as realizadas anteriores - Detallar</td>
                                    <td><input type="text" name="cirugias_ant_titular"></td>
                                    <td><input type="text" name="cirugias_ant_esposa"></td>
                                    <td><input type="text" name="cirugias_ant_hijo1"></td>
                                    <td><input type="text" name="cirugias_ant_hijo2"></td>
                                    <td><input type="text" name="cirugias_ant_hijo3"></td>
                                    <td><input type="text" name="cirugias_ant_hijo4"></td>
                                    <td><input type="text" name="cirugias_ant_hijo5"></td>
                                </tr>
                                <tr>
                                    <td>Cirug√≠as pendientes que tiene que realizar - Detallar</td>
                                    <td><input type="text" name="cirugias_pen_titular"></td>
                                    <td><input type="text" name="cirugias_pen_esposa"></td>
                                    <td><input type="text" name="cirugias_pen_hijo1"></td>
                                    <td><input type="text" name="cirugias_pen_hijo2"></td>
                                    <td><input type="text" name="cirugias_pen_hijo3"></td>
                                    <td><input type="text" name="cirugias_pen_hijo4"></td>
                                    <td><input type="text" name="cirugias_pen_hijo5"></td>
                                </tr>
                                <tr>
                                    <td>Tratamientos pendientes a realizar - Detallar</td>
                                    <td><input type="text" name="trat_pen_titular"></td>
                                    <td><input type="text" name="trat_pen_esposa"></td>
                                    <td><input type="text" name="trat_pen_hijo1"></td>
                                    <td><input type="text" name="trat_pen_hijo2"></td>
                                    <td><input type="text" name="trat_pen_hijo3"></td>
                                    <td><input type="text" name="trat_pen_hijo4"></td>
                                    <td><input type="text" name="trat_pen_hijo5"></td>
                                </tr>
                                <tr>
                                    <td>Tiene alguna pr√≥tesis colocadas - Detallar</td>
                                    <td><input type="text" name="protesis_titular"></td>
                                    <td><input type="text" name="protesis_esposa"></td>
                                    <td><input type="text" name="protesis_hijo1"></td>
                                    <td><input type="text" name="protesis_hijo2"></td>
                                    <td><input type="text" name="protesis_hijo3"></td>
                                    <td><input type="text" name="protesis_hijo4"></td>
                                    <td><input type="text" name="protesis_hijo5"></td>
                                </tr>
                                <tr>
                                    <td>Est√° o necesita tratamiento psicol√≥gico</td>
                                    <td><input type="text" name="psico_titular"></td>
                                    <td><input type="text" name="psico_esposa"></td>
                                    <td><input type="text" name="psico_hijo1"></td>
                                    <td><input type="text" name="psico_hijo2"></td>
                                    <td><input type="text" name="psico_hijo3"></td>
                                    <td><input type="text" name="psico_hijo4"></td>
                                    <td><input type="text" name="psico_hijo5"></td>
                                </tr>
                                <tr>
                                    <td>Est√° o necesita tratamiento nutricional</td>
                                    <td><input type="text" name="nutri_titular"></td>
                                    <td><input type="text" name="nutri_esposa"></td>
                                    <td><input type="text" name="nutri_hijo1"></td>
                                    <td><input type="text" name="nutri_hijo2"></td>
                                    <td><input type="text" name="nutri_hijo3"></td>
                                    <td><input type="text" name="nutri_hijo4"></td>
                                    <td><input type="text" name="nutri_hijo5"></td>
                                </tr>
                                <tr>
                                    <td>Est√° o necesita tratamiento pedag√≥gico</td>
                                    <td><input type="text" name="peda_titular"></td>
                                    <td><input type="text" name="peda_esposa"></td>
                                    <td><input type="text" name="peda_hijo1"></td>
                                    <td><input type="text" name="peda_hijo2"></td>
                                    <td><input type="text" name="peda_hijo3"></td>
                                    <td><input type="text" name="peda_hijo4"></td>
                                    <td><input type="text" name="peda_hijo5"></td>
                                </tr>
                                <tr>
                                    <td>Est√° o necesita tratamiento oftalmol√≥gico</td>
                                    <td><input type="text" name="oftalmo_titular"></td>
                                    <td><input type="text" name="oftalmo_esposa"></td>
                                    <td><input type="text" name="oftalmo_hijo1"></td>
                                    <td><input type="text" name="oftalmo_hijo2"></td>
                                    <td><input type="text" name="oftalmo_hijo3"></td>
                                    <td><input type="text" name="oftalmo_hijo4"></td>
                                    <td><input type="text" name="oftalmo_hijo5"></td>
                                </tr>
                                <tr>
                                    <td>Est√° o necesita tratamiento odontol√≥gico</td>
                                    <td><input type="text" name="odonto_titular"></td>
                                    <td><input type="text" name="odonto_esposa"></td>
                                    <td><input type="text" name="odonto_hijo1"></td>
                                    <td><input type="text" name="odonto_hijo2"></td>
                                    <td><input type="text" name="odonto_hijo3"></td>
                                    <td><input type="text" name="odonto_hijo4"></td>
                                    <td><input type="text" name="odonto_hijo5"></td>
                                </tr>
                                <tr>
                                    <td>Est√° tomando alguna medicaci√≥n cr√≥nica - Detallar</td>
                                    <td><input type="text" name="med_cronica_titular"></td>
                                    <td><input type="text" name="med_cronica_esposa"></td>
                                    <td><input type="text" name="med_cronica_hijo1"></td>
                                    <td><input type="text" name="med_cronica_hijo2"></td>
                                    <td><input type="text" name="med_cronica_hijo3"></td>
                                    <td><input type="text" name="med_cronica_hijo4"></td>
                                    <td><input type="text" name="med_cronica_hijo5"></td>
                                </tr>
                                <tr>
                                    <td>Es al√©rgico a alg√∫n medicamento - Detallar</td>
                                    <td><input type="text" name="alergia_titular"></td>
                                    <td><input type="text" name="alergia_esposa"></td>
                                    <td><input type="text" name="alergia_hijo1"></td>
                                    <td><input type="text" name="alergia_hijo2"></td>
                                    <td><input type="text" name="alergia_hijo3"></td>
                                    <td><input type="text" name="alergia_hijo4"></td>
                                    <td><input type="text" name="alergia_hijo5"></td>
                                </tr>
                                <tr>
                                    <td>Tiene problemas de varices</td>
                                    <td><input type="text" name="varices_titular"></td>
                                    <td><input type="text" name="varices_esposa"></td>
                                    <td><input type="text" name="varices_hijo1"></td>
                                    <td><input type="text" name="varices_hijo2"></td>
                                    <td><input type="text" name="varices_hijo3"></td>
                                    <td><input type="text" name="varices_hijo4"></td>
                                    <td><input type="text" name="varices_hijo5"></td>
                                </tr>
                                <tr>
                                    <td>Tuvo o tiene presi√≥n alta</td>
                                    <td><input type="text" name="presion_titular"></td>
                                    <td><input type="text" name="presion_esposa"></td>
                                    <td><input type="text" name="presion_hijo1"></td>
                                    <td><input type="text" name="presion_hijo2"></td>
                                    <td><input type="text" name="presion_hijo3"></td>
                                    <td><input type="text" name="presion_hijo4"></td>
                                    <td><input type="text" name="presion_hijo5"></td>
                                </tr>
                                <tr>
                                    <td>Tuvo o tiene diabetes</td>
                                    <td><input type="text" name="diabetes_titular"></td>
                                    <td><input type="text" name="diabetes_esposa"></td>
                                    <td><input type="text" name="diabetes_hijo1"></td>
                                    <td><input type="text" name="diabetes_hijo2"></td>
                                    <td><input type="text" name="diabetes_hijo3"></td>
                                    <td><input type="text" name="diabetes_hijo4"></td>
                                    <td><input type="text" name="diabetes_hijo5"></td>
                                </tr>
                                <tr>
                                    <td>Est√° embarazada (Si lo est√°, especifique de cuantos meses en observaciones)</td>
                                    <td><input type="text" name="embarazo_titular"></td>
                                    <td><input type="text" name="embarazo_esposa"></td>
                                    <td><input type="text" name="embarazo_hijo1"></td>
                                    <td><input type="text" name="embarazo_hijo2"></td>
                                    <td><input type="text" name="embarazo_hijo3"></td>
                                    <td><input type="text" name="embarazo_hijo4"></td>
                                    <td><input type="text" name="embarazo_hijo5"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">Observaciones</div>
                    <div class="form-group">
                        <label for="observaciones">Detallar y agregar alguna otra condici√≥n que no est√© mencionada dentro de esta declaraci√≥n jurada:</label>
                        <textarea name="observaciones" id="observaciones" rows="4"></textarea>
                    </div>
                </div>

                <div class="form-navigation">
                    <button type="button" class="btn btn-secondary" onclick="prevSection(2)">Anterior</button>
                    <button type="button" class="btn" onclick="validateAndNext(2)">Siguiente</button>
                </div>
            </div>

            <!-- Secci√≥n 3: Grupo Familiar -->
            <div class="form-section" id="section3">
                <div class="card">
                    <div class="card-header">Grupo Familiar</div>
                    <p class="mb-4">Complete los datos de los integrantes del grupo familiar</p>
                    
                    <table>
                        <thead>
                            <tr>
                                <th>Apellido y Nombres</th>
                                <th>Parentesco</th>
                                <th>Documento</th>
                                <th>Fecha de Nacimiento</th>
                                <th>Observaciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><input type="text" name="gf_nombre1"></td>
                                <td><input type="text" name="gf_parentesco1"></td>
                                <td><input type="text" name="gf_documento1"></td>
                                <td><input type="date" name="gf_fecha_nac1"></td>
                                <td><input type="text" name="gf_observ1"></td>
                            </tr>
                            <tr>
                                <td><input type="text" name="gf_nombre2"></td>
                                <td><input type="text" name="gf_parentesco2"></td>
                                <td><input type="text" name="gf_documento2"></td>
                                <td><input type="date" name="gf_fecha_nac2"></td>
                                <td><input type="text" name="gf_observ2"></td>
                            </tr>
                            <tr>
                                <td><input type="text" name="gf_nombre3"></td>
                                <td><input type="text" name="gf_parentesco3"></td>
                                <td><input type="text" name="gf_documento3"></td>
                                <td><input type="date" name="gf_fecha_nac3"></td>
                                <td><input type="text" name="gf_observ3"></td>
                            </tr>
                            <tr>
                                <td><input type="text" name="gf_nombre4"></td>
                                <td><input type="text" name="gf_parentesco4"></td>
                                <td><input type="text" name="gf_documento4"></td>
                                <td><input type="date" name="gf_fecha_nac4"></td>
                                <td><input type="text" name="gf_observ4"></td>
                            </tr>
                            <tr>
                                <td><input type="text" name="gf_nombre5"></td>
                                <td><input type="text" name="gf_parentesco5"></td>
                                <td><input type="text" name="gf_documento5"></td>
                                <td><input type="date" name="gf_fecha_nac5"></td>
                                <td><input type="text" name="gf_observ5"></td>
                            </tr>
                            <tr>
                                <td><input type="text" name="gf_nombre6"></td>
                                <td><input type="text" name="gf_parentesco6"></td>
                                <td><input type="text" name="gf_documento6"></td>
                                <td><input type="date" name="gf_fecha_nac6"></td>
                                <td><input type="text" name="gf_observ6"></td>
                            </tr>
                            <tr>
                                <td><input type="text" name="gf_nombre7"></td>
                                <td><input type="text" name="gf_parentesco7"></td>
                                <td><input type="text" name="gf_documento7"></td>
                                <td><input type="date" name="gf_fecha_nac7"></td>
                                <td><input type="text" name="gf_observ7"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="form-navigation">
                    <button type="button" class="btn btn-secondary" onclick="prevSection(3)">Anterior</button>
                    <button type="button" class="btn" onclick="validateAndNext(3)">Siguiente</button>
                </div>
            </div>

            <!-- Secci√≥n 4: Documentaci√≥n -->
            <div class="form-section" id="section4">
                <div class="card">
                    <div class="card-header">Documentaci√≥n</div>
                    
                    <div class="form-group">
                        <label>Adjuntar Documentaci√≥n</label>
                        <div class="file-upload" id="fileUploadArea">
                            <p>Haga clic aqu√≠ o arrastre los archivos para adjuntar</p>
                            <p class="small-text">Formatos aceptados: JPG, PNG, PDF</p>
                            <input type="file" name="documentos" id="documentos" class="file-upload-input" multiple accept="image/*,application/pdf">
                        </div>
                        <ul class="file-list" id="fileList"></ul>
                        
                        <!-- Contenedor para mostrar las previsualizaciones de im√°genes -->
                        <div class="image-preview-container" id="imagePreviewContainer"></div>
                    </div>
                    
                    <div class="important-notice">
                        <strong>IMPORTANTE:</strong><br>
                        SE DEJA EXPRESAMENTE ACLARADO QUE EL GRUPO FAMILIAR DEL AFILIADO PARA OBTENER LA COBERTURA DE LA OBRA SOCIAL DEBER√Å PRESENTAR TODA LA DOCUMENTACI√ìN REQUERIDA.<br><br>
                        <strong>DOCUMENTACI√ìN A PRESENTAR:</strong><br>
                        <strong>ESPOSA/O C√ìNYUGE:</strong> CERTIFICADO DE CASAMIENTO EN EL CASO QUE ESTUVIERAN CASADOS LEGALMENTE. PARA CONVIVIENTE: CERTIFICADO DE CONCUBINATO CON DOS TESTIGOS NO MAYOR A 1 A√ëO AL MOMENTO DE AFILIARSE. SI TUVIERA HIJOS QUE NO SON DEL TITULAR DEBER√ÅN DECLARARLOS EN EL CERTIFICADO DONDE DEBEN INFORMAR QUE EST√ÅN A CARGO DEL TITULAR. FOTOCOPIA DE DOCUMENTO DE LOS DOS LADOS.<br>
                        <strong>HIJOS:</strong> CERTIFICADO DE NACIMIENTO, FOTOCOPIA DEL DOCUMENTO DE LOS DOS LADOS. EN CASO DE SER MAYOR A 21 A√ëOS EL ORIGINAL DEL CERTIFICADO DE ESTUDIOS EMITIDO POR EL CENTRO DE ESTUDIOS.
                    </div>
                </div>

                <div class="form-navigation">
                    <button type="button" class="btn btn-secondary" onclick="prevSection(4)">Anterior</button>
                    <button type="button" class="btn" onclick="validateAndNext(4)">Siguiente</button>
                </div>
            </div>

            <!-- Secci√≥n 5: Confirmaci√≥n -->
            <div class="form-section" id="section5">
                <div class="card">
                    <div class="card-header">Firma y Confirmaci√≥n</div>
                    
                    <div class="form-group">
                        <label for="signatureCanvas" class="required">Firma:</label>
                        <div class="signature-container">
                            <canvas id="signatureCanvas" width="400" height="150"></canvas>
                            <input type="hidden" name="firma" id="firmaInput">
                            <div class="validation-error" id="firma_error">La firma es obligatoria</div>
                            <button type="button" class="btn btn-secondary mt-4" onclick="clearSignature()">Borrar Firma</button>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <label for="aclaracion" class="required">Aclaraci√≥n:</label>
                            <input type="text" id="aclaracion" name="aclaracion" required>
                            <div class="validation-error" id="aclaracion_error">Este campo es obligatorio</div>
                        </div>
                        <div class="form-col">
                            <label for="documento" class="required">Documento:</label>
                            <input type="text" id="documento" name="documento" required>
                            <div class="validation-error" id="documento_error">Este campo es obligatorio</div>
                        </div>
                        <div class="form-col">
                            <label for="fecha" class="required">Fecha:</label>
                            <input type="date" id="fecha" name="fecha" required>
                            <div class="validation-error" id="fecha_error">Este campo es obligatorio</div>
                        </div>
                    </div>
                    
                    <div class="form-group mt-4">
                        <div class="google-drive-button" id="saveToGoogleDrive">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/1/12/Google_Drive_icon_%282020%29.svg/512px-Google_Drive_icon_%282020%29.svg.png" alt="Google Drive" class="google-drive-icon">
                            <span>Guardar en Google Drive</span>
                        </div>
                        <div class="google-drive-status" id="googleDriveStatus"></div>
                    </div>
                </div>

                <div class="form-navigation">
                    <button type="button" class="btn btn-secondary" onclick="prevSection(5)">Anterior</button>
                    <button type="submit" class="btn">Enviar Formulario</button>
                </div>
            </div>
        </form>

        <div class="success-message" id="successMessage">
            <h3>¬°Formulario enviado con √©xito!</h3>
            <p>El formulario se ha completado correctamente y se ha guardado en Google Drive. Para acceder a la credencial deber√° comunicarse con la casilla de <strong>afiliaciones@conexionsalud.com.ar</strong></p>
            <button type="button" class="btn mt-4" onclick="downloadPDF()">Descargar PDF</button>
        </div>

        <div class="error-message" id="errorMessage">
            <h3>Error al enviar el formulario</h3>
            <p>Por favor, verifique los datos ingresados e intente nuevamente.</p>
        </div>

        <div id="confirmModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Confirmaci√≥n</h3>
                    <span class="close-modal">&times;</span>
                </div>
                <div class="modal-body">
                    <p>¬øEst√° seguro que desea descargar el formulario en PDF?</p>
                    <p class="small-text">Tenga en cuenta que el PDF incluir√° todos los datos ingresados hasta el momento.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" id="cancelDownload">Cancelar</button>
                    <button type="button" class="btn" id="confirmDownload">Descargar PDF</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Variables globales
        const canvas = document.getElementById('signatureCanvas');
        const ctx = canvas.getContext('2d');
        let drawing = false;
        let lastX = 0;
        let lastY = 0;
        let uploadedFiles = [];
        let imagePreviewsForPDF = [];
        let googleDriveAccessToken = null;
        
        // Configuraci√≥n de Google Drive API
        const CLIENT_ID = 'YOUR_GOOGLE_CLIENT_ID'; // Reemplazar con tu Client ID
        const API_KEY = 'YOUR_GOOGLE_API_KEY'; // Reemplazar con tu API Key
        const DISCOVERY_DOCS = ['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest'];
        const SCOPES = 'https://www.googleapis.com/auth/drive.file';
        
        // Configuraci√≥n inicial
        document.addEventListener('DOMContentLoaded', function() {
            setupSignatureCanvas();
            setupFileUpload();
            setupDateAutoFill();
            setupGoogleDriveButton();
            
            // Establecer la fecha actual en el campo de fecha
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('fecha').value = today;
            
            // Precargar el logo para asegurar que est√© disponible para el PDF
            preloadLogo();
        });
        
        // Configuraci√≥n de Google Drive
        function setupGoogleDriveButton() {
            document.getElementById('saveToGoogleDrive').addEventListener('click', function() {
                if (!googleDriveAccessToken) {
                    initGoogleDriveAPI();
                } else {
                    savePDFToGoogleDrive();
                }
            });
        }
        
        function initGoogleDriveAPI() {
            gapi.load('client:auth2', () => {
                gapi.client.init({
                    apiKey: API_KEY,
                    clientId: CLIENT_ID,
                    discoveryDocs: DISCOVERY_DOCS,
                    scope: SCOPES
                }).then(() => {
                    // Escuchar eventos de inicio de sesi√≥n
                    gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);
                    
                    // Manejar el estado de inicio de sesi√≥n inicial
                    updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
                    
                    // Iniciar sesi√≥n si no est√° autenticado
                    if (!gapi.auth2.getAuthInstance().isSignedIn.get()) {
                        gapi.auth2.getAuthInstance().signIn();
                    }
                }).catch(error => {
                    console.error('Error al inicializar Google Drive API:', error);
                    updateGoogleDriveStatus('Error al conectar con Google Drive. Por favor, intente nuevamente.', false);
                });
            });
        }
        
        function updateSigninStatus(isSignedIn) {
            if (isSignedIn) {
                googleDriveAccessToken = gapi.auth2.getAuthInstance().currentUser.get().getAuthResponse().access_token;
                updateGoogleDriveStatus('Conectado a Google Drive. Listo para guardar el formulario.', true);
            } else {
                googleDriveAccessToken = null;
                updateGoogleDriveStatus('No conectado a Google Drive.', false);
            }
        }
        
        function updateGoogleDriveStatus(message, success) {
            const statusElement = document.getElementById('googleDriveStatus');
            statusElement.textContent = message;
            statusElement.className = 'google-drive-status';
            if (success) {
                statusElement.classList.add('success');
            } else {
                statusElement.classList.add('error');
            }
        }
        
        async function savePDFToGoogleDrive() {
            if (!googleDriveAccessToken) {
                updateGoogleDriveStatus('No est√° conectado a Google Drive. Por favor, inicie sesi√≥n.', false);
                return;
            }
            
            try {
                // Mostrar indicador de carga
                document.getElementById('loadingIndicator').style.display = 'flex';
                document.getElementById('loadingText').textContent = 'Guardando en Google Drive...';
                
                // Generar el PDF
                const pdfBlob = await generatePDFBlob();
                
                // Obtener el CUIT para el nombre del archivo
                const cuit = document.getElementById('titular_cuit').value || 'formulario';
                const fileName = `Declaracion_Jurada_OSPETAX_${cuit}.pdf`;
                
                // Crear el archivo en Google Drive
                const metadata = {
                    name: fileName,
                    mimeType: 'application/pdf',
                };
                
                const form = new FormData();
                form.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
                form.append('file', pdfBlob);
                
                const response = await fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart', {
                    method: 'POST',
                    headers: {
                        Authorization: `Bearer ${googleDriveAccessToken}`,
                    },
                    body: form,
                });
                
                if (!response.ok) {
                    throw new Error('Error al guardar el archivo en Google Drive');
                }
                
                const result = await response.json();
                
                // Actualizar el estado
                updateGoogleDriveStatus(`Formulario guardado correctamente en Google Drive como "${fileName}"`, true);
                
                return result;
            } catch (error) {
                console.error('Error al guardar en Google Drive:', error);
                updateGoogleDriveStatus('Error al guardar en Google Drive. Por favor, intente nuevamente.', false);
                throw error;
            } finally {
                // Ocultar indicador de carga
                document.getElementById('loadingIndicator').style.display = 'none';
            }
        }
        
        // Precargar el logo
        function preloadLogo() {
            const logoImg = document.getElementById('logoOspetax');
            logoImg.onload = function() {
                console.log('Logo cargado correctamente');
            };
            logoImg.onerror = function() {
                console.error('Error al cargar el logo');
            };
        }
        
        // Configuraci√≥n del canvas para firma
        function setupSignatureCanvas() {
            ctx.lineWidth = 2;
            ctx.lineCap = 'round';
            ctx.strokeStyle = '#000';
            
            // Eventos de mouse
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);
            
            // Eventos t√°ctiles
            canvas.addEventListener('touchstart', startDrawingTouch);
            canvas.addEventListener('touchmove', drawTouch);
            canvas.addEventListener('touchend', stopDrawing);
        }
        
        function getPosition(e) {
            const rect = canvas.getBoundingClientRect();
            return {
                x: e.clientX - rect.left,
                y: e.clientY - rect.top
            };
        }
        
        function startDrawing(e) {
            drawing = true;
            const pos = getPosition(e);
            lastX = pos.x;
            lastY = pos.y;
            ctx.beginPath();
            ctx.moveTo(lastX, lastY);
        }
        
        function draw(e) {
            if (!drawing) return;
            const pos = getPosition(e);
            ctx.lineTo(pos.x, pos.y);
            ctx.stroke();
            lastX = pos.x;
            lastY = pos.y;
        }
        
        function startDrawingTouch(e) {
            e.preventDefault();
            drawing = true;
            const touch = e.touches[0];
            const rect = canvas.getBoundingClientRect();
            lastX = touch.clientX - rect.left;
            lastY = touch.clientY - rect.top;
            ctx.beginPath();
            ctx.moveTo(lastX, lastY);
        }
        
        function drawTouch(e) {
            if (!drawing) return;
            e.preventDefault();
            const touch = e.touches[0];
            const rect = canvas.getBoundingClientRect();
            const x = touch.clientX - rect.left;
            const y = touch.clientY - rect.top;
            ctx.lineTo(x, y);
            ctx.stroke();
            lastX = x;
            lastY = y;
        }
        
        function stopDrawing() {
            if (drawing) {
                drawing = false;
                ctx.closePath();
                document.getElementById('firmaInput').value = canvas.toDataURL();
                // Ocultar mensaje de error si hay firma
                if (document.getElementById('firmaInput').value) {
                    document.getElementById('firma_error').style.display = 'none';
                }
            }
        }
        
        function clearSignature() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            document.getElementById('firmaInput').value = '';
        }
        
        // Configuraci√≥n de carga de archivos
        function setupFileUpload() {
            const fileUploadArea = document.getElementById('fileUploadArea');
            const fileInput = document.getElementById('documentos');
            const fileList = document.getElementById('fileList');
            const imagePreviewContainer = document.getElementById('imagePreviewContainer');
            
            fileUploadArea.addEventListener('click', function() {
                fileInput.click();
            });
            
            fileUploadArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                fileUploadArea.classList.add('dragover');
            });
            
            fileUploadArea.addEventListener('dragleave', function() {
                fileUploadArea.classList.remove('dragover');
            });
            
            fileUploadArea.addEventListener('drop', function(e) {
                e.preventDefault();
                fileUploadArea.classList.remove('dragover');
                const files = e.dataTransfer.files;
                handleFiles(files);
            });
            
            fileInput.addEventListener('change', function() {
                handleFiles(this.files);
            });
            
            function handleFiles(files) {
                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    if (file.type.match('image.*') || file.type === 'application/pdf') {
                        uploadedFiles.push(file);
                        
                        const li = document.createElement('li');
                        li.className = 'file-item';
                        li.innerHTML = `
                            <span>${file.name} (${formatFileSize(file.size)})</span>
                            <span class="file-remove" data-index="${uploadedFiles.length - 1}">√ó</span>
                        `;
                        fileList.appendChild(li);
                        
                        // Si es una imagen, crear una previsualizaci√≥n
                        if (file.type.match('image.*')) {
                            const reader = new FileReader();
                            reader.onload = function(e) {
                                const imgPreview = document.createElement('img');
                                imgPreview.src = e.target.result;
                                imgPreview.className = 'image-preview';
                                imgPreview.dataset.index = uploadedFiles.length - 1;
                                imagePreviewContainer.appendChild(imgPreview);
                                
                                // Guardar la imagen para el PDF
                                imagePreviewsForPDF.push({
                                    index: uploadedFiles.length - 1,
                                    src: e.target.result,
                                    name: file.name
                                });
                            };
                            reader.readAsDataURL(file);
                        }
                    }
                }
                
                // Agregar eventos para eliminar archivos
                document.querySelectorAll('.file-remove').forEach(button => {
                    button.addEventListener('click', function() {
                        const index = parseInt(this.getAttribute('data-index'));
                        
                        // Eliminar la previsualizaci√≥n si existe
                        const preview = document.querySelector(`.image-preview[data-index="${index}"]`);
                        if (preview) {
                            preview.remove();
                            
                            // Eliminar de las im√°genes para PDF
                            const previewIndex = imagePreviewsForPDF.findIndex(img => img.index === index);
                            if (previewIndex !== -1) {
                                imagePreviewsForPDF.splice(previewIndex, 1);
                            }
                        }
                        
                        // Eliminar el archivo
                        uploadedFiles.splice(index, 1);
                        this.parentElement.remove();
                        
                        // Actualizar √≠ndices
                        document.querySelectorAll('.file-remove').forEach((btn, idx) => {
                            btn.setAttribute('data-index', idx);
                        });
                        
                        document.querySelectorAll('.image-preview').forEach((img, idx) => {
                            img.dataset.index = idx;
                        });
                        
                        // Actualizar √≠ndices en imagePreviewsForPDF
                        imagePreviewsForPDF.forEach((img, idx) => {
                            img.index = idx;
                        });
                    });
                });
            }
            
            function formatFileSize(bytes) {
                if (bytes < 1024) return bytes + ' bytes';
                else if (bytes < 1048576) return (bytes / 1024).toFixed(1) + ' KB';
                else return (bytes / 1048576).toFixed(1) + ' MB';
            }
        }
        
        // Auto-completar edad a partir de la fecha de nacimiento
        function setupDateAutoFill() {
            const fechaNacInput = document.getElementById('titular_fecha_nac');
            const edadInput = document.getElementById('titular_edad');
            
            fechaNacInput.addEventListener('change', function() {
                if (this.value) {
                    const birthDate = new Date(this.value);
                    const today = new Date();
                    
                    // C√°lculo preciso de la edad
                    let age = today.getFullYear() - birthDate.getFullYear();
                    const monthDiff = today.getMonth() - birthDate.getMonth();
                    
                    if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                        age--;
                    }
                    
                    edadInput.value = age;
                }
            });
        }
        
        // Validaci√≥n de campos
        function validateField(field) {
            const errorElement = document.getElementById(`${field.id}_error`);
            if (!errorElement) return true;
            
            let isValid = true;
            
            if (field.hasAttribute('required') && !field.value.trim()) {
                errorElement.style.display = 'block';
                field.classList.add('invalid');
                isValid = false;
            } else if (field.type === 'email' && field.value.trim() && !isValidEmail(field.value)) {
                errorElement.style.display = 'block';
                field.classList.add('invalid');
                isValid = false;
            } else if (field.hasAttribute('pattern') && field.value.trim() && !new RegExp(field.getAttribute('pattern')).test(field.value)) {
                errorElement.style.display = 'block';
                field.classList.add('invalid');
                isValid = false;
            } else {
                errorElement.style.display = 'none';
                field.classList.remove('invalid');
            }
            
            return isValid;
        }
        
        function isValidEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }
        
        function validateSection(sectionNumber) {
            const section = document.getElementById(`section${sectionNumber}`);
            const fields = section.querySelectorAll('input, textarea, select');
            
            let isValid = true;
            
            fields.forEach(field => {
                if (!validateField(field)) {
                    isValid = false;
                }
            });
            
            // Validaci√≥n especial para la firma en la secci√≥n 5
            if (sectionNumber === 5) {
                const firmaInput = document.getElementById('firmaInput');
                const firmaError = document.getElementById('firma_error');
                
                if (!firmaInput.value) {
                    firmaError.style.display = 'block';
                    isValid = false;
                } else {
                    firmaError.style.display = 'none';
                }
            }
            
            return isValid;
        }
        
        // Navegaci√≥n entre secciones con validaci√≥n
        function validateAndNext(currentSection) {
            if (validateSection(currentSection)) {
                nextSection(currentSection);
            } else {
                // Scroll al primer error
                const firstError = document.querySelector(`#section${currentSection} .validation-error[style="display: block"]`);
                if (firstError) {
                    firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }
        }
        
        function nextSection(currentSection) {
            document.getElementById(`section${currentSection}`).classList.remove('active');
            document.getElementById(`section${currentSection + 1}`).classList.add('active');
            
            document.querySelector(`.step[data-step="${currentSection}"]`).classList.add('completed');
            document.querySelector(`.step[data-step="${currentSection + 1}"]`).classList.add('active');
            
            updateProgressBar();
            window.scrollTo(0, 0);
        }
        
        function prevSection(currentSection) {
            document.getElementById(`section${currentSection}`).classList.remove('active');
            document.getElementById(`section${currentSection - 1}`).classList.add('active');
            
            document.querySelector(`.step[data-step="${currentSection}"]`).classList.remove('active');
            document.querySelector(`.step[data-step="${currentSection - 1}"]`).classList.add('active');
            
            updateProgressBar();
            window.scrollTo(0, 0);
        }
        
        function updateProgressBar() {
            const totalSections = 5;
            const activeSections = document.querySelectorAll('.step.completed, .step.active').length;
            const progress = (activeSections / totalSections) * 100;
            document.getElementById('progressBar').style.width = `${progress}%`;
        }
        
        // Funci√≥n para descargar PDF
        function downloadPDF() {
            // Mostrar el modal de confirmaci√≥n
            const modal = document.getElementById('confirmModal');
            modal.style.display = 'block';
            
            // Configurar los botones del modal
            document.getElementById('confirmDownload').onclick = function() {
                modal.style.display = 'none';
                generateAndDownloadPDF();
            };
            
            document.getElementById('cancelDownload').onclick = function() {
                modal.style.display = 'none';
            };
            
            document.querySelector('.close-modal').onclick = function() {
                modal.style.display = 'none';
            };
            
            // Cerrar el modal si se hace clic fuera de √©l
            window.onclick = function(event) {
                if (event.target == modal) {
                    modal.style.display = 'none';
                }
            };
        }
        
        // Funci√≥n para generar y descargar el PDF
        async function generateAndDownloadPDF() {
            // Mostrar indicador de carga
            document.getElementById('loadingIndicator').style.display = 'flex';
            document.getElementById('loadingText').textContent = 'Generando PDF, por favor espere...';
            
            try {
                const pdfBlob = await generatePDFBlob();
                
                // Crear un enlace para descargar el PDF
                const url = URL.createObjectURL(pdfBlob);
                const a = document.createElement('a');
                const cuit = document.getElementById('titular_cuit').value || 'formulario';
                a.href = url;
                a.download = `Declaracion_Jurada_OSPETAX_${cuit}.pdf`;
                document.body.appendChild(a);
                a.click();
                
                // Limpiar
                setTimeout(() => {
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }, 100);
            } catch (error) {
                console.error('Error al generar el PDF:', error);
                alert('Ocurri√≥ un error al generar el PDF. Por favor, intente nuevamente.');
            } finally {
                // Ocultar indicador de carga
                document.getElementById('loadingIndicator').style.display = 'none';
            }
        }
        
        // Funci√≥n para generar el PDF como Blob
        async function generatePDFBlob() {
            // Asegurarse de que el logo est√© cargado
            const logoImg = document.getElementById('logoOspetax');
            
            // Esperar a que el logo se cargue completamente
            if (!logoImg.complete) {
                await new Promise(resolve => {
                    logoImg.onload = resolve;
                    logoImg.onerror = resolve; // Continuar incluso si hay error
                });
            }
            
            // Crear un clon del contenedor para no modificar el original
            const formContainer = document.getElementById('formContainer');
            const clone = formContainer.cloneNode(true);
            
            // Aplicar estilos para el PDF
            clone.style.background = 'white';
            clone.style.padding = '20px';
            clone.style.maxWidth = '100%';
            clone.style.position = 'absolute';
            clone.style.left = '-9999px';
            clone.style.top = '0';
            
            // Asegurarse de que todas las secciones sean visibles en el clon
            const sections = clone.querySelectorAll('.form-section');
            sections.forEach(section => {
                section.style.display = 'block';
                section.classList.add('active');
            });
            
            // Ocultar elementos de navegaci√≥n y botones en el clon
            const elementsToHide = clone.querySelectorAll('.form-navigation, .step-indicator, .progress-container, .download-button-container, .modal, .file-upload, .file-list, .validation-error, .google-drive-button, .google-drive-status');
            elementsToHide.forEach(el => {
                el.style.display = 'none';
            });
            
            // Ocultar el mensaje de √©xito en el clon
            const successMessage = clone.querySelector('.success-message');
            if (successMessage) {
                successMessage.style.display = 'none';
            }
            
            // A√±adir t√≠tulo para el PDF
            const title = document.createElement('h1');
            title.textContent = 'DECLARACI√ìN JURADA DE SALUD - OSPETAX';
            title.style.textAlign = 'center';
            title.style.marginBottom = '20px';
            title.style.color = '#0056b3';
            
            // A√±adir fecha de generaci√≥n
            const dateInfo = document.createElement('p');
            const today = new Date();
            dateInfo.textContent = `Documento generado el: ${today.toLocaleDateString('es-AR')}`;
            dateInfo.style.textAlign = 'right';
            dateInfo.style.fontSize = '12px';
            dateInfo.style.marginBottom = '30px';
            
            // Insertar t√≠tulo y fecha al principio del clon
            clone.insertBefore(dateInfo, clone.firstChild);
            clone.insertBefore(title, clone.firstChild);
            
            // Asegurarse de que la firma se muestre en el PDF
            const originalSignatureCanvas = document.getElementById('signatureCanvas');
            const signatureDataURL = document.getElementById('firmaInput').value;
            
            if (signatureDataURL) {
                const signatureSection = clone.querySelector('.signature-container');
                const cloneCanvas = signatureSection.querySelector('canvas');
                
                // Reemplazar el canvas con una imagen de la firma
                const signatureImg = document.createElement('img');
                signatureImg.src = signatureDataURL;
                signatureImg.style.width = '100%';
                signatureImg.style.maxWidth = '400px';
                signatureImg.style.border = '1px solid #dee2e6';
                signatureImg.style.borderRadius = '4px';
                
                if (cloneCanvas) {
                    cloneCanvas.replaceWith(signatureImg);
                } else {
                    signatureSection.appendChild(signatureImg);
                }
            }
            
            // A√±adir las im√°genes adjuntadas al PDF
            if (imagePreviewsForPDF.length > 0) {
                const docsSection = clone.querySelector('#section4 .card');
                
                // Crear un contenedor para las im√°genes
                const imagesContainer = document.createElement('div');
                imagesContainer.style.marginTop = '20px';
                
                // A√±adir t√≠tulo para las im√°genes
                const imagesTitle = document.createElement('h3');
                imagesTitle.textContent = 'Documentaci√≥n Adjunta';
                imagesTitle.style.marginBottom = '15px';
                imagesContainer.appendChild(imagesTitle);
                
                // A√±adir cada imagen
                imagePreviewsForPDF.forEach((imgData, index) => {
                    const imgContainer = document.createElement('div');
                    imgContainer.style.marginBottom = '15px';
                    
                    const imgTitle = document.createElement('p');
                    imgTitle.textContent = `Documento ${index + 1}: ${imgData.name}`;
                    imgTitle.style.fontWeight = 'bold';
                    imgTitle.style.marginBottom = '5px';
                    
                    const img = document.createElement('img');
                    img.src = imgData.src;
                    img.style.maxWidth = '100%';
                    img.style.maxHeight = '300px';
                    img.style.border = '1px solid #dee2e6';
                    img.style.borderRadius = '4px';
                    
                    imgContainer.appendChild(imgTitle);
                    imgContainer.appendChild(img);
                    imagesContainer.appendChild(imgContainer);
                });
                
                docsSection.appendChild(imagesContainer);
            }
            
            // A√±adir el clon al documento para poder capturarlo
            document.body.appendChild(clone);
            
            // Configurar opciones para html2canvas
            const options = {
                scale: 1,
                useCORS: true,
                allowTaint: true,
                logging: false,
                scrollY: 0
            };
            
            try {
                // Capturar el formulario
                const canvas = await html2canvas(clone, options);
                
                // Eliminar el clon despu√©s de capturarlo
                document.body.removeChild(clone);
                
                const imgData = canvas.toDataURL('image/png');
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF('p', 'mm', 'a4');
                
                // Dimensiones de p√°gina A4
                const pageWidth = pdf.internal.pageSize.getWidth();
                const pageHeight = pdf.internal.pageSize.getHeight();
                
                // Calcular dimensiones manteniendo la proporci√≥n
                const imgWidth = pageWidth;
                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                
                let heightLeft = imgHeight;
                let position = 0;
                
                // A√±adir la primera p√°gina
                pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;
                
                // A√±adir p√°ginas adicionales si es necesario
                while (heightLeft >= 0) {
                    position = heightLeft - imgHeight;
                    pdf.addPage();
                    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }
                
                // Convertir el PDF a Blob
                return pdf.output('blob');
            } catch (error) {
                console.error('Error al generar el PDF:', error);
                throw error;
            }
        }
        
        // Funci√≥n para enviar el formulario
        async function submitForm(event) {
            event.preventDefault();
            
            // Validar todos los campos
            let isValid = true;
            for (let i = 1; i <= 5; i++) {
                if (!validateSection(i)) {
                    isValid = false;
                    // Mostrar la secci√≥n con errores
                    document.querySelectorAll('.form-section').forEach(section => {
                        section.classList.remove('active');
                    });
                    document.getElementById(`section${i}`).classList.add('active');
                    
                    // Actualizar los indicadores de paso
                    document.querySelectorAll('.step').forEach(step => {
                        step.classList.remove('active');
                    });
                    document.querySelector(`.step[data-step="${i}"]`).classList.add('active');
                    
                    // Scroll al primer error
                    const firstError = document.querySelector(`#section${i} .validation-error[style="display: block"]`);
                    if (firstError) {
                        firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                    
                    break;
                }
            }
            
            if (!isValid) {
                return;
            }
            
            // Mostrar indicador de carga
            document.getElementById('loadingIndicator').style.display = 'flex';
            document.getElementById('loadingText').textContent = 'Enviando formulario y guardando en Google Drive...';
            
            try {
                // Guardar en Google Drive si est√° disponible
                if (googleDriveAccessToken) {
                    await savePDFToGoogleDrive();
                }
                
                // Aqu√≠ se podr√≠a implementar el env√≠o de datos al servidor
                // Por ahora, solo mostramos el mensaje de √©xito
                document.getElementById('healthForm').style.display = 'none';
                document.getElementById('successMessage').style.display = 'block';
                
                // Scroll al mensaje
                window.scrollTo(0, 0);
            } catch (error) {
                console.error('Error al enviar el formulario:', error);
                document.getElementById('errorMessage').style.display = 'block';
                document.getElementById('errorMessage').scrollIntoView({ behavior: 'smooth' });
            } finally {
                // Ocultar indicador de carga
                document.getElementById('loadingIndicator').style.display = 'none';
            }
        }
    </script>
</body>
</html>